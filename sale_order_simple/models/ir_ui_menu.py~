from openerp import models, api, tools


class Menu(models.Model):
    _inherit = 'ir.ui.menu'

    @api.cr_uid_context
    @tools.ormcache_context('uid', 'debug', keys=('lang',))
    def load_menus(self, cr, uid, debug, context=None):
        menu_root = super(ir_ui_menu, self).load_menus(cr, 1, debug, context=context)
        data_obj = self.pool['ir.model.data']
        vcn_parent = data_obj.xmlid_to_res_id(cr, uid, 'vcn_rental.vcn_rental_root')
        expenses = data_obj.xmlid_to_res_id(cr, uid, 'hr_expense.menu_hr_expense_root')
        vcn_odoo_submenu = data_obj.xmlid_to_res_id(cr, uid, 'vcn_rental.menu_vcn_odoo')
        vcn_user_group_id = self.pool['res.groups'].search(cr, uid, [('name', '=', 'VCN USER')], context=context)
        if vcn_user_group_id:
            vcn_user_group = self.pool['res.groups'].browse(cr, uid, vcn_user_group_id, context=context)
            if uid != 1 and vcn_user_group and uid in vcn_user_group.users.ids:
                children =  filter(lambda menu: menu['id'] in [vcn_parent, expenses], menu_root['children'])
                menu_root['children'] = children
                if children:
                    children1 = filter(lambda menu: menu['id'] != vcn_odoo_submenu, children[0]['children'])
                    children[0]['children'] = children1
                    ids = [children[0]['id']] + [ch['id'] for ch in children[0]['children']]
                    menu_root['all_menu_ids'] = ids
        return menu_root
